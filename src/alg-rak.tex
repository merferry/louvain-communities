\begin{algorithm}[hbtp]
\caption{Our parallel Label Propagation Algorithm (LPA).}
\label{alg:rak}
\begin{algorithmic}[1]
\Function{lpa}{$G$} \label{alg:rak--main-begin}
  \State Vertex membership: $C' \gets [0 .. |V|)$ \textbf{;} $G' \gets G$ \label{alg:rak--initialization}
  \State Mark all vertices in $G'$ as unprocessed
  \ForAll{$l_i \in [0 .. \text{\small{MAX\_ITERATIONS}})$} \label{alg:rak--iterations-begin}
    \State $\Delta N \gets lpaMove(G', C')$ \label{alg:rak--propagate}
    \If{$\Delta N/N \le \tau$} \textbf{break} \Comment{Converged?} \label{alg:rak--converged}
    \EndIf
  \EndFor \label{alg:rak--iterations-end}
  \Return{$C'$}
\EndFunction \label{alg:rak--main-end}

\Statex

\Function{lpaMove}{$G', C'$} \label{alg:rak--move-begin}
  \State Changed vertices: $\Delta N \gets 0$
  \ForAll{unprocessed $i \in V'$ \textbf{in parallel}}
    \State Mark $i$ as processed (prune) \label{alg:rak--prune}
    \State $c^* \gets$ Most weighted label to $i$ in $G'$ \label{alg:rak--best-community}
    \If{$c^* = C'[i]$} \textbf{continue} \label{alg:rak--best-community-same}
    \EndIf
    \State $C'[i] \gets c^*$ \textbf{;} $\Delta N \gets \Delta N + 1$ \label{alg:rak--perform-move}
    \State Mark neighbors of $i$ as unprocessed \label{alg:rak--remark}
  \EndFor
\Return{$\Delta N$}
\EndFunction \label{alg:rak--move-end}
\end{algorithmic}
\end{algorithm}




%% Parameter setting
% TOLERANCE = 0.05
% MAX\_ITERATIONS = 20
% MAX\_THREADS = 12
